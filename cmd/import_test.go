package cmd

import (
	"encoding/base64"
	"fmt"
	"strings"
	"testing"

	"github.com/google/go-cmp/cmp"
	k8s "k8s.io/client-go/tools/clientcmd/api/v1"
)

func TestDetermineConfigs(t *testing.T) {
	tt := map[string]struct {
		InConfig           string
		ExpError           error
		ExpNumOfKonfigFile int
		ExpKonfigFiles     []*konfigFile
	}{
		"SingleClusterSingleContext": {
			InConfig:           singleClusterSingleContext,
			ExpError:           nil,
			ExpNumOfKonfigFile: 1,
			ExpKonfigFiles: []*konfigFile{
				{
					FileName: "~/.kube/konfs/dev-eu_dev-eu-1",
					Content: k8s.Config{
						APIVersion:     "v1",
						Kind:           "Config",
						CurrentContext: "dev-eu",
						Clusters: []k8s.NamedCluster{
							{
								Name: "dev-eu-1",
								Cluster: k8s.Cluster{
									Server:                   "https://10.1.1.0",
									CertificateAuthorityData: b64Dec(t, "Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"),
								},
							},
						},
						Contexts: []k8s.NamedContext{
							{
								Name: "dev-eu",
								Context: k8s.Context{
									Cluster:   "dev-eu-1",
									Namespace: "kube-public",
									AuthInfo:  "dev-eu",
								},
							},
						},
						AuthInfos: []k8s.NamedAuthInfo{
							{
								Name: "dev-eu",
								AuthInfo: k8s.AuthInfo{
									ClientKeyData:         b64Dec(t, "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDWEFJQkFBS0JnUUNxR0t1a08xRGU3emhaajYrSDBxdGpUa1Z4d1RDcHZLZTRlQ1owRlBxcmkwY2IySlpmWEovRGdZU0Y2dlVwCndtSkc4d1ZRWktqZUdjakRPTDVVbHN1dXNGbmNDeldCUTdSS05VU2VzbVFSTVNHa1ZiMS8zaitza1o2VXRXKzV1MDlsSE5zajZ0UTUKMXMxU1ByQ0JrZWRiTmYwVHAwR2JNSkR5UjRlOVQwNFpad0lEQVFBQkFvR0FGaWprbzU2K3FHeU44TTBSVnlhUkFYeisreFRxSEJMaAozdHg0VmdNdHJRK1dFZ0NqaG9Ud28yM0tNQkF1SkdTWW5SbW9CWk0zbE1mVEtldklrQWlkUEV4dllDZG01ZFlxM1hUb0xra0x2NUwyCnBJSVZPRk1ERytLRVNuQUZWN2wyYytjbnpSTVcwK2I2ZjhtUjFDSnpadXhWTEw2UTAyZnZMaTU1L21iU1l4RUNRUURlQXc2ZmlJUVgKR3VrQkk0ZU1aWnQ0bnNjeTJvMTJLeVluZXIzVnBvZUUrTnAycStaM3B2QU1kL2FOelEvVzlXYUkrTlJmY3hVSnJtZlB3SUdtNjNpbApBa0VBeENMNUhRYjJiUXI0QnlvcmNNV20vaEVQMk1aelJPVjczeUY0MWhQc1JDOW02NktyaGVPOUhQVEp1bzMvOXM1cCtzcUd4T2xGCkwwTkR0NFNrb3NqZ0d3SkFGa2x5UjF1Wi93UEpqajYxMWNkQmN6dGxQZHFveHNzUUduaDg1QnpDai91M1dxQnBFMnZqdnl5dnlJNWsKWDZ6azdTMGxqS3R0MmpueTIrMDBWc0JlclFKQkFKR0MxTWc1T3lkbzVOd0Q2QmlST3JQeEdvMmJwVGJ1L2ZoclQ4ZWJIa1R6MmVwbApVOVZRUVNRelkxb1pNVlg4aTFtNVdVVExQejJ5TEpJQlFWZFhxaE1DUUJHb2l1U29TamFmVWhWN2kxY0VHcGI4OGg1TkJZWnpXWEdaCjM3c0o1UXNXK3NKeW9OZGUzeEg4dmRYaHpVN2VUODJENlgvc2N3OVJaeisvNnJDSjRwMD0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0="),
									ClientCertificateData: b64Dec(t, "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWI4Q0FnMzdNQTBHQ1NxR1NJYjNEUUVCQlFVQU1JR2JNUXN3Q1FZRFZRUUdFd0pLVURFT01Bd0cKQTFVRUNCTUZWRzlyZVc4eEVEQU9CZ05WQkFjVEIwTm9kVzh0YTNVeEVUQVBCZ05WQkFvVENFWnlZVzVyTkVSRQpNUmd3RmdZRFZRUUxFdzlYWldKRFpYSjBJRk4xY0hCdmNuUXhHREFXQmdOVkJBTVREMFp5WVc1ck5FUkVJRmRsCllpQkRRVEVqTUNFR0NTcUdTSWIzRFFFSkFSWVVjM1Z3Y0c5eWRFQm1jbUZ1YXpSa1pDNWpiMjB3SGhjTk1USXcKT0RJeU1EVXlOekl6V2hjTk1UY3dPREl4TURVeU56SXpXakJLTVFzd0NRWURWUVFHRXdKS1VERU9NQXdHQTFVRQpDQXdGVkc5cmVXOHhFVEFQQmdOVkJBb01DRVp5WVc1ck5FUkVNUmd3RmdZRFZRUUREQTkzZDNjdVpYaGhiWEJzClpTNWpiMjB3Z1o4d0RRWUpLb1pJaHZjTkFRRUJCUUFEZ1kwQU1JR0pBb0dCQU1ZQkJyeDVQbFAwV05JL1pkekQKKzZQa3RtdXJuK0Yya1FZYnRjN1hRaDgvTFRCdkNvK1A2aVpvTEVtVUE5ZTdFWExSeGdVMUNWcWVBaTdRY0FuOQpNd0JsYzhrc0ZKSEIwcnRmOXBtZjhPemE5RTBCeW5scS80L0tiMXgrZCtBeWhMN29LOXRRd0IyNHVIT3VlSGkxCkMvaVZ2OENTV0tpWWU2aHpOMXR4WWU4ckFnTUJBQUV3RFFZSktvWklodmNOQVFFRkJRQURnWUVBQVNQZGppZ0oKa1hDcUtXcG5aL09jNzVFVWNNaTZIenRhVzhhYlVNbFlYUElna1YyRjdZYW5IT0I3SzRmN09PTGppejhEVFBGZgpqQzlVZXVFcmhhQS96eldpOGV3TVRGWlcvV3NoT3JtM2ZOdmNNck1MS3RINTM0Skt2Y2RNZzZxSWRqVEZJTklyCmV2bkFoZjBjd1VMYWVibitsTXM4UGRsN3kzNytzZmx1Vm9rPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="),
								},
							},
						},
					},
				},
			},
		},
		"multiClusterMultiContext": {
			InConfig:           multiClusterMultiContext,
			ExpError:           nil,
			ExpNumOfKonfigFile: 2,
			ExpKonfigFiles: []*konfigFile{
				{
					FileName: "~/.kube/konfs/dev-asia_dev-asia-1",
					Content: k8s.Config{
						APIVersion:     "v1",
						Kind:           "Config",
						CurrentContext: "dev-asia",
						Clusters: []k8s.NamedCluster{
							{
								Name: "dev-asia-1",
								Cluster: k8s.Cluster{
									Server:                   "https://192.168.0.1",
									CertificateAuthorityData: b64Dec(t, "Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"),
								},
							},
						},
						Contexts: []k8s.NamedContext{
							{
								Name: "dev-asia",
								Context: k8s.Context{
									Cluster:   "dev-asia-1",
									Namespace: "kube-system",
									AuthInfo:  "dev-asia",
								},
							},
						},
						AuthInfos: []k8s.NamedAuthInfo{
							{
								Name: "dev-asia",
								AuthInfo: k8s.AuthInfo{
									Token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
								},
							},
						},
					},
				},
				{
					FileName: "~/.kube/konfs/dev-eu_dev-eu-1",
					Content: k8s.Config{
						APIVersion:     "v1",
						Kind:           "Config",
						CurrentContext: "dev-eu",
						Clusters: []k8s.NamedCluster{
							{
								Name: "dev-eu-1",
								Cluster: k8s.Cluster{
									Server:                   "https://10.1.1.0",
									CertificateAuthorityData: b64Dec(t, "Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"),
								},
							},
						},
						Contexts: []k8s.NamedContext{
							{
								Name: "dev-eu",
								Context: k8s.Context{
									Cluster:   "dev-eu-1",
									Namespace: "kube-public",
									AuthInfo:  "dev-eu",
								},
							},
						},
						AuthInfos: []k8s.NamedAuthInfo{
							{
								Name: "dev-eu",
								AuthInfo: k8s.AuthInfo{
									ClientKeyData:         b64Dec(t, "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDWEFJQkFBS0JnUUNxR0t1a08xRGU3emhaajYrSDBxdGpUa1Z4d1RDcHZLZTRlQ1owRlBxcmkwY2IySlpmWEovRGdZU0Y2dlVwCndtSkc4d1ZRWktqZUdjakRPTDVVbHN1dXNGbmNDeldCUTdSS05VU2VzbVFSTVNHa1ZiMS8zaitza1o2VXRXKzV1MDlsSE5zajZ0UTUKMXMxU1ByQ0JrZWRiTmYwVHAwR2JNSkR5UjRlOVQwNFpad0lEQVFBQkFvR0FGaWprbzU2K3FHeU44TTBSVnlhUkFYeisreFRxSEJMaAozdHg0VmdNdHJRK1dFZ0NqaG9Ud28yM0tNQkF1SkdTWW5SbW9CWk0zbE1mVEtldklrQWlkUEV4dllDZG01ZFlxM1hUb0xra0x2NUwyCnBJSVZPRk1ERytLRVNuQUZWN2wyYytjbnpSTVcwK2I2ZjhtUjFDSnpadXhWTEw2UTAyZnZMaTU1L21iU1l4RUNRUURlQXc2ZmlJUVgKR3VrQkk0ZU1aWnQ0bnNjeTJvMTJLeVluZXIzVnBvZUUrTnAycStaM3B2QU1kL2FOelEvVzlXYUkrTlJmY3hVSnJtZlB3SUdtNjNpbApBa0VBeENMNUhRYjJiUXI0QnlvcmNNV20vaEVQMk1aelJPVjczeUY0MWhQc1JDOW02NktyaGVPOUhQVEp1bzMvOXM1cCtzcUd4T2xGCkwwTkR0NFNrb3NqZ0d3SkFGa2x5UjF1Wi93UEpqajYxMWNkQmN6dGxQZHFveHNzUUduaDg1QnpDai91M1dxQnBFMnZqdnl5dnlJNWsKWDZ6azdTMGxqS3R0MmpueTIrMDBWc0JlclFKQkFKR0MxTWc1T3lkbzVOd0Q2QmlST3JQeEdvMmJwVGJ1L2ZoclQ4ZWJIa1R6MmVwbApVOVZRUVNRelkxb1pNVlg4aTFtNVdVVExQejJ5TEpJQlFWZFhxaE1DUUJHb2l1U29TamFmVWhWN2kxY0VHcGI4OGg1TkJZWnpXWEdaCjM3c0o1UXNXK3NKeW9OZGUzeEg4dmRYaHpVN2VUODJENlgvc2N3OVJaeisvNnJDSjRwMD0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0="),
									ClientCertificateData: b64Dec(t, "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWI4Q0FnMzdNQTBHQ1NxR1NJYjNEUUVCQlFVQU1JR2JNUXN3Q1FZRFZRUUdFd0pLVURFT01Bd0cKQTFVRUNCTUZWRzlyZVc4eEVEQU9CZ05WQkFjVEIwTm9kVzh0YTNVeEVUQVBCZ05WQkFvVENFWnlZVzVyTkVSRQpNUmd3RmdZRFZRUUxFdzlYWldKRFpYSjBJRk4xY0hCdmNuUXhHREFXQmdOVkJBTVREMFp5WVc1ck5FUkVJRmRsCllpQkRRVEVqTUNFR0NTcUdTSWIzRFFFSkFSWVVjM1Z3Y0c5eWRFQm1jbUZ1YXpSa1pDNWpiMjB3SGhjTk1USXcKT0RJeU1EVXlOekl6V2hjTk1UY3dPREl4TURVeU56SXpXakJLTVFzd0NRWURWUVFHRXdKS1VERU9NQXdHQTFVRQpDQXdGVkc5cmVXOHhFVEFQQmdOVkJBb01DRVp5WVc1ck5FUkVNUmd3RmdZRFZRUUREQTkzZDNjdVpYaGhiWEJzClpTNWpiMjB3Z1o4d0RRWUpLb1pJaHZjTkFRRUJCUUFEZ1kwQU1JR0pBb0dCQU1ZQkJyeDVQbFAwV05JL1pkekQKKzZQa3RtdXJuK0Yya1FZYnRjN1hRaDgvTFRCdkNvK1A2aVpvTEVtVUE5ZTdFWExSeGdVMUNWcWVBaTdRY0FuOQpNd0JsYzhrc0ZKSEIwcnRmOXBtZjhPemE5RTBCeW5scS80L0tiMXgrZCtBeWhMN29LOXRRd0IyNHVIT3VlSGkxCkMvaVZ2OENTV0tpWWU2aHpOMXR4WWU4ckFnTUJBQUV3RFFZSktvWklodmNOQVFFRkJRQURnWUVBQVNQZGppZ0oKa1hDcUtXcG5aL09jNzVFVWNNaTZIenRhVzhhYlVNbFlYUElna1YyRjdZYW5IT0I3SzRmN09PTGppejhEVFBGZgpqQzlVZXVFcmhhQS96eldpOGV3TVRGWlcvV3NoT3JtM2ZOdmNNck1MS3RINTM0Skt2Y2RNZzZxSWRqVEZJTklyCmV2bkFoZjBjd1VMYWVibitsTXM4UGRsN3kzNytzZmx1Vm9rPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="),
								},
							},
						},
					},
				},
			},
		},
		"multiClusterSingleContext": {
			InConfig:           multiClusterSingleContext,
			ExpError:           nil,
			ExpNumOfKonfigFile: 1,
			ExpKonfigFiles: []*konfigFile{
				{
					FileName: "~/.kube/konfs/dev-asia_dev-asia-1",
					Content: k8s.Config{
						APIVersion:     "v1",
						Kind:           "Config",
						CurrentContext: "dev-asia",
						Clusters: []k8s.NamedCluster{
							{
								Name: "dev-asia-1",
								Cluster: k8s.Cluster{
									Server:                   "https://192.168.0.1",
									CertificateAuthorityData: b64Dec(t, "Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t"),
								},
							},
						},
						Contexts: []k8s.NamedContext{
							{
								Name: "dev-asia",
								Context: k8s.Context{
									Cluster:   "dev-asia-1",
									Namespace: "kube-system",
									AuthInfo:  "dev-asia",
								},
							},
						},
						AuthInfos: []k8s.NamedAuthInfo{
							{
								Name: "dev-asia",
								AuthInfo: k8s.AuthInfo{
									Token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
								},
							},
						},
					},
				},
			},
		},
		"emptyConfig": {
			InConfig:           "",
			ExpError:           nil,
			ExpNumOfKonfigFile: 0,
			ExpKonfigFiles:     []*konfigFile{},
		},
		// All for the coverage ;)
		"invalidConfig": {
			InConfig:           "I am not valid yaml",
			ExpError:           fmt.Errorf("error unmarshaling JSON: while decoding JSON: json: cannot unmarshal string into Go value of type v1.Config"),
			ExpNumOfKonfigFile: 0,
			ExpKonfigFiles:     nil,
		},
	}

	for name, tc := range tt {
		tc := tc
		t.Run(name, func(t *testing.T) {
			t.Parallel()

			res, err := determineConfigs(strings.NewReader(tc.InConfig))

			if !equalError(err, tc.ExpError) {
				t.Errorf("Want error '%s', got '%s'", tc.ExpError, err)
			}

			if len(tc.ExpKonfigFiles) != tc.ExpNumOfKonfigFile {
				t.Errorf("Want %d, got %d kubeconfigs", tc.ExpNumOfKonfigFile, len(tc.ExpKonfigFiles))
			}

			if !cmp.Equal(tc.ExpKonfigFiles, res) {
				t.Errorf("Exp and given KonfigFiles differ:\n'%s'", cmp.Diff(tc.ExpKonfigFiles, res))
			}

		})
	}

}

// All certificate & token values are mocked
var singleClusterSingleContext = `
apiVersion: v1
clusters:
  - cluster:
      certificate-authority-data: Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      server: https://10.1.1.0
    name: dev-eu-1
contexts:
  - context:
      namespace: kube-public
      cluster: dev-eu-1
      user: dev-eu
    name: dev-eu
current-context: dev-eu
kind: Config
preferences: {}
users:
  - name: dev-eu
    user:
      client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDWEFJQkFBS0JnUUNxR0t1a08xRGU3emhaajYrSDBxdGpUa1Z4d1RDcHZLZTRlQ1owRlBxcmkwY2IySlpmWEovRGdZU0Y2dlVwCndtSkc4d1ZRWktqZUdjakRPTDVVbHN1dXNGbmNDeldCUTdSS05VU2VzbVFSTVNHa1ZiMS8zaitza1o2VXRXKzV1MDlsSE5zajZ0UTUKMXMxU1ByQ0JrZWRiTmYwVHAwR2JNSkR5UjRlOVQwNFpad0lEQVFBQkFvR0FGaWprbzU2K3FHeU44TTBSVnlhUkFYeisreFRxSEJMaAozdHg0VmdNdHJRK1dFZ0NqaG9Ud28yM0tNQkF1SkdTWW5SbW9CWk0zbE1mVEtldklrQWlkUEV4dllDZG01ZFlxM1hUb0xra0x2NUwyCnBJSVZPRk1ERytLRVNuQUZWN2wyYytjbnpSTVcwK2I2ZjhtUjFDSnpadXhWTEw2UTAyZnZMaTU1L21iU1l4RUNRUURlQXc2ZmlJUVgKR3VrQkk0ZU1aWnQ0bnNjeTJvMTJLeVluZXIzVnBvZUUrTnAycStaM3B2QU1kL2FOelEvVzlXYUkrTlJmY3hVSnJtZlB3SUdtNjNpbApBa0VBeENMNUhRYjJiUXI0QnlvcmNNV20vaEVQMk1aelJPVjczeUY0MWhQc1JDOW02NktyaGVPOUhQVEp1bzMvOXM1cCtzcUd4T2xGCkwwTkR0NFNrb3NqZ0d3SkFGa2x5UjF1Wi93UEpqajYxMWNkQmN6dGxQZHFveHNzUUduaDg1QnpDai91M1dxQnBFMnZqdnl5dnlJNWsKWDZ6azdTMGxqS3R0MmpueTIrMDBWc0JlclFKQkFKR0MxTWc1T3lkbzVOd0Q2QmlST3JQeEdvMmJwVGJ1L2ZoclQ4ZWJIa1R6MmVwbApVOVZRUVNRelkxb1pNVlg4aTFtNVdVVExQejJ5TEpJQlFWZFhxaE1DUUJHb2l1U29TamFmVWhWN2kxY0VHcGI4OGg1TkJZWnpXWEdaCjM3c0o1UXNXK3NKeW9OZGUzeEg4dmRYaHpVN2VUODJENlgvc2N3OVJaeisvNnJDSjRwMD0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0=
      client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWI4Q0FnMzdNQTBHQ1NxR1NJYjNEUUVCQlFVQU1JR2JNUXN3Q1FZRFZRUUdFd0pLVURFT01Bd0cKQTFVRUNCTUZWRzlyZVc4eEVEQU9CZ05WQkFjVEIwTm9kVzh0YTNVeEVUQVBCZ05WQkFvVENFWnlZVzVyTkVSRQpNUmd3RmdZRFZRUUxFdzlYWldKRFpYSjBJRk4xY0hCdmNuUXhHREFXQmdOVkJBTVREMFp5WVc1ck5FUkVJRmRsCllpQkRRVEVqTUNFR0NTcUdTSWIzRFFFSkFSWVVjM1Z3Y0c5eWRFQm1jbUZ1YXpSa1pDNWpiMjB3SGhjTk1USXcKT0RJeU1EVXlOekl6V2hjTk1UY3dPREl4TURVeU56SXpXakJLTVFzd0NRWURWUVFHRXdKS1VERU9NQXdHQTFVRQpDQXdGVkc5cmVXOHhFVEFQQmdOVkJBb01DRVp5WVc1ck5FUkVNUmd3RmdZRFZRUUREQTkzZDNjdVpYaGhiWEJzClpTNWpiMjB3Z1o4d0RRWUpLb1pJaHZjTkFRRUJCUUFEZ1kwQU1JR0pBb0dCQU1ZQkJyeDVQbFAwV05JL1pkekQKKzZQa3RtdXJuK0Yya1FZYnRjN1hRaDgvTFRCdkNvK1A2aVpvTEVtVUE5ZTdFWExSeGdVMUNWcWVBaTdRY0FuOQpNd0JsYzhrc0ZKSEIwcnRmOXBtZjhPemE5RTBCeW5scS80L0tiMXgrZCtBeWhMN29LOXRRd0IyNHVIT3VlSGkxCkMvaVZ2OENTV0tpWWU2aHpOMXR4WWU4ckFnTUJBQUV3RFFZSktvWklodmNOQVFFRkJRQURnWUVBQVNQZGppZ0oKa1hDcUtXcG5aL09jNzVFVWNNaTZIenRhVzhhYlVNbFlYUElna1YyRjdZYW5IT0I3SzRmN09PTGppejhEVFBGZgpqQzlVZXVFcmhhQS96eldpOGV3TVRGWlcvV3NoT3JtM2ZOdmNNck1MS3RINTM0Skt2Y2RNZzZxSWRqVEZJTklyCmV2bkFoZjBjd1VMYWVibitsTXM4UGRsN3kzNytzZmx1Vm9rPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
`

var multiClusterMultiContext = `
apiVersion: v1
clusters:
  - cluster:
      certificate-authority-data: Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      server: https://192.168.0.1
    name: dev-asia-1
  - cluster:
      certificate-authority-data: Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      server: https://10.1.1.0
    name: dev-eu-1
contexts:
  - context:
      namespace: kube-system
      cluster: dev-asia-1
      user: dev-asia
    name: dev-asia
  - context:
      namespace: kube-public
      cluster: dev-eu-1
      user: dev-eu
    name: dev-eu
current-context: dev-eu
kind: Config
preferences: {}
users:
  - name: dev-asia
    user:
      token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
  - name: dev-eu
    user:
      client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlDWEFJQkFBS0JnUUNxR0t1a08xRGU3emhaajYrSDBxdGpUa1Z4d1RDcHZLZTRlQ1owRlBxcmkwY2IySlpmWEovRGdZU0Y2dlVwCndtSkc4d1ZRWktqZUdjakRPTDVVbHN1dXNGbmNDeldCUTdSS05VU2VzbVFSTVNHa1ZiMS8zaitza1o2VXRXKzV1MDlsSE5zajZ0UTUKMXMxU1ByQ0JrZWRiTmYwVHAwR2JNSkR5UjRlOVQwNFpad0lEQVFBQkFvR0FGaWprbzU2K3FHeU44TTBSVnlhUkFYeisreFRxSEJMaAozdHg0VmdNdHJRK1dFZ0NqaG9Ud28yM0tNQkF1SkdTWW5SbW9CWk0zbE1mVEtldklrQWlkUEV4dllDZG01ZFlxM1hUb0xra0x2NUwyCnBJSVZPRk1ERytLRVNuQUZWN2wyYytjbnpSTVcwK2I2ZjhtUjFDSnpadXhWTEw2UTAyZnZMaTU1L21iU1l4RUNRUURlQXc2ZmlJUVgKR3VrQkk0ZU1aWnQ0bnNjeTJvMTJLeVluZXIzVnBvZUUrTnAycStaM3B2QU1kL2FOelEvVzlXYUkrTlJmY3hVSnJtZlB3SUdtNjNpbApBa0VBeENMNUhRYjJiUXI0QnlvcmNNV20vaEVQMk1aelJPVjczeUY0MWhQc1JDOW02NktyaGVPOUhQVEp1bzMvOXM1cCtzcUd4T2xGCkwwTkR0NFNrb3NqZ0d3SkFGa2x5UjF1Wi93UEpqajYxMWNkQmN6dGxQZHFveHNzUUduaDg1QnpDai91M1dxQnBFMnZqdnl5dnlJNWsKWDZ6azdTMGxqS3R0MmpueTIrMDBWc0JlclFKQkFKR0MxTWc1T3lkbzVOd0Q2QmlST3JQeEdvMmJwVGJ1L2ZoclQ4ZWJIa1R6MmVwbApVOVZRUVNRelkxb1pNVlg4aTFtNVdVVExQejJ5TEpJQlFWZFhxaE1DUUJHb2l1U29TamFmVWhWN2kxY0VHcGI4OGg1TkJZWnpXWEdaCjM3c0o1UXNXK3NKeW9OZGUzeEg4dmRYaHpVN2VUODJENlgvc2N3OVJaeisvNnJDSjRwMD0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0=
      client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWakNDQWI4Q0FnMzdNQTBHQ1NxR1NJYjNEUUVCQlFVQU1JR2JNUXN3Q1FZRFZRUUdFd0pLVURFT01Bd0cKQTFVRUNCTUZWRzlyZVc4eEVEQU9CZ05WQkFjVEIwTm9kVzh0YTNVeEVUQVBCZ05WQkFvVENFWnlZVzVyTkVSRQpNUmd3RmdZRFZRUUxFdzlYWldKRFpYSjBJRk4xY0hCdmNuUXhHREFXQmdOVkJBTVREMFp5WVc1ck5FUkVJRmRsCllpQkRRVEVqTUNFR0NTcUdTSWIzRFFFSkFSWVVjM1Z3Y0c5eWRFQm1jbUZ1YXpSa1pDNWpiMjB3SGhjTk1USXcKT0RJeU1EVXlOekl6V2hjTk1UY3dPREl4TURVeU56SXpXakJLTVFzd0NRWURWUVFHRXdKS1VERU9NQXdHQTFVRQpDQXdGVkc5cmVXOHhFVEFQQmdOVkJBb01DRVp5WVc1ck5FUkVNUmd3RmdZRFZRUUREQTkzZDNjdVpYaGhiWEJzClpTNWpiMjB3Z1o4d0RRWUpLb1pJaHZjTkFRRUJCUUFEZ1kwQU1JR0pBb0dCQU1ZQkJyeDVQbFAwV05JL1pkekQKKzZQa3RtdXJuK0Yya1FZYnRjN1hRaDgvTFRCdkNvK1A2aVpvTEVtVUE5ZTdFWExSeGdVMUNWcWVBaTdRY0FuOQpNd0JsYzhrc0ZKSEIwcnRmOXBtZjhPemE5RTBCeW5scS80L0tiMXgrZCtBeWhMN29LOXRRd0IyNHVIT3VlSGkxCkMvaVZ2OENTV0tpWWU2aHpOMXR4WWU4ckFnTUJBQUV3RFFZSktvWklodmNOQVFFRkJRQURnWUVBQVNQZGppZ0oKa1hDcUtXcG5aL09jNzVFVWNNaTZIenRhVzhhYlVNbFlYUElna1YyRjdZYW5IT0I3SzRmN09PTGppejhEVFBGZgpqQzlVZXVFcmhhQS96eldpOGV3TVRGWlcvV3NoT3JtM2ZOdmNNck1MS3RINTM0Skt2Y2RNZzZxSWRqVEZJTklyCmV2bkFoZjBjd1VMYWVibitsTXM4UGRsN3kzNytzZmx1Vm9rPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
`

var multiClusterSingleContext = `
apiVersion: v1
clusters:
  - cluster:
      certificate-authority-data: Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      server: https://192.168.0.1
    name: dev-asia-1
  - cluster:
      certificate-authority-data: Ci0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFY3pDQ0ExdWdBd0lCQWdJQkFEQU5CZ2txaGtpRzl3MEJBUVFGQUQuLkFrR0ExVUVCaE1DUjBJeApFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkRBU0JnTlZCQW9UQzAuLjBFZ1RIUmtNVGN3TlFZRApWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY21sdFlYSjVJRU5sY24uLlhScGIyNGdRWFYwYUc5eQphWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUV4MFpEQWVGdzB3TUQuLlRVd01UWmFGdzB3TVRBeQpNRFF4T1RVd01UWmFNSUdITVFzd0NRWURWUVFHRXdKSFFqRVRNQkVHQTEuLjI5dFpTMVRkR0YwWlRFVQpNQklHQTFVRUNoTUxRbVZ6ZENCRFFTQk1kR1F4TnpBMUJnTlZCQXNUTGsuLkRFZ1VIVmliR2xqSUZCeQphVzFoY25rZ1EyVnlkR2xtYVdOaGRHbHZiaUJCZFhSb2IzSnBkSGt4RkQuLkFNVEMwSmxjM1FnUTBFZwpUSFJrTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2cuLlR6Mm1yN1NaaUFNZlF5dQp2QmpNOU9pSmpSYXpYQloxQmpQNUNFL1dtL1JyNTAwUFJLK0xoOXg1ZUouLi9BTkJFMHNUSzBac0RHTQphazJtMWc3b3J1STNkWTNWSHFJeEZUejBUYTFkK05BanduTGU0bk9iNy8uLmswNVNoaEJySkdCS0t4Ygo4bjEwNG8vNXA4SEFzWlBkemJGTUl5TmpKekJNMm81eTVBMTN3aUxpdEUuLmZ5WWtRemF4Q3cwQXd6bAprVkhpSXlDdWFGNHdqNTcxcFN6a3Y2c3YrNElETWJUL1hwQ284TDZ3VGEuLnNoK2V0TEQ2RnRUalliYgpydlo4UlFNMXRsS2RvTUhnMnF4cmFBVisrSE5CWW1OV3MwZHVFZGpVYkouLlhJOVR0blM0bzFDa2o3UApPZmxqaVFJREFRQUJvNEhuTUlIa01CMEdBMVVkRGdRV0JCUTh1ck1DUkwuLjVBa0lwOU5KSEp3NVRDQgp0QVlEVlIwakJJR3NNSUdwZ0JROHVyTUNSTFlZTUhVS1U1QWtJcDlOSkguLmFTQmlqQ0JoekVMTUFrRwpBMVVFQmhNQ1IwSXhFekFSQmdOVkJBZ1RDbE52YldVdFUzUmhkR1V4RkQuLkFvVEMwSmxjM1FnUTBFZwpUSFJrTVRjd05RWURWUVFMRXk1RGJHRnpjeUF4SUZCMVlteHBZeUJRY20uLkVObGNuUnBabWxqWVhScApiMjRnUVhWMGFHOXlhWFI1TVJRd0VnWURWUVFERXd0Q1pYTjBJRU5CSUUuLkRBTUJnTlZIUk1FQlRBRApBUUgvTUEwR0NTcUdTSWIzRFFFQkJBVUFBNElCQVFDMXVZQmNzU25jd0EuLkRDc1Flcjc3MkMydWNwWAp4UVVFL0MwcFdXbTZnRGt3ZDVEMERTTURKUnFWL3dlb1o0d0M2QjczZjUuLmJMaEdZSGFYSmVTRDZLcgpYY29Pd0xkU2FHbUpZc2xMS1pCM1pJREVwMHdZVEdoZ3RlYjZKRmlUdG4uLnNmMnhkcllmUENpSUI3ZwpCTUFWN0d6ZGM0VnNwUzZsanJBaGJpaWF3ZEJpUWxRbXNCZUZ6OUprRjQuLmIzbDhCb0dOK3FNYTU2WQpJdDh1bmEyZ1k0bDJPLy9vbjg4cjVJV0psbTFMMG9BOGU0ZlIyeXJCSFguLmFkc0dlRktreU5yd0dpLwo3dlFNZlhkR3NSclhOR1JHblgrdldEWjMveldJMGpvRHRDa05ucUVwVm4uLkhvWAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      server: https://10.1.1.0
    name: dev-eu-1
contexts:
  - context:
      namespace: kube-system
      cluster: dev-asia-1
      user: dev-asia
    name: dev-asia
# Purposefully kept this wrong
current-context: dev-eu
kind: Config
preferences: {}
users:
  - name: dev-asia
    user:
      token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
`
var singleClusterMultiContext = `
`

var invalidConfig = `{"hehe": "I am not yaml ;)"}`

func b64Dec(t *testing.T, in string) []byte {
	res, err := base64.StdEncoding.DecodeString(in)
	if err != nil {
		t.Fatalf("There seems to be an error in base64-test-data. Offending String: '%s'", in)
	}
	return []byte(res)
}

// equalError reports whether errors a and b are considered equal.
// They're equal if both are nil, or both are not nil and a.Error() == b.Error().
func equalError(a, b error) bool {
	return a == nil && b == nil || a != nil && b != nil && a.Error() == b.Error()
}
